
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>William's Blog with Octopress</title>
  <meta name="author" content="William Herry">

  
  <meta name="description" content="这篇文档简单记录一下使用omniauth-github的过程 这里有个能跑的代码可以clone看看效果omniauth-github-demo 首先新建项目: 1
rails new omniauth-github-demo 为了让示例看起来不是很难看,我会把bootstrap也进来: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://williamherry.github.com/blog/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="William's Blog with Octopress" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


<!-- this font looks great -->
<link href='http://fonts.googleapis.com/css?family=Delius' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">William's Blog with Octopress</a></h1>
  
    <h2>Octopress is A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:williamherry.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/29/omniauth-github-demo/">Omniauth-github使用示例</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-29T11:57:00+08:00" pubdate data-updated="true">Jul 29<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/07/29/omniauth-github-demo/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这篇文档简单记录一下使用omniauth-github的过程</p>

<p>这里有个能跑的代码可以clone看看效果<a href="https://github.com/williamherry/omniauth-github-demo">omniauth-github-demo</a></p>

<p>首先新建项目:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new omniauth-github-demo</span></code></pre></td></tr></table></div></figure>


<p>为了让示例看起来不是很难看,我会把bootstrap也进来:</p>

<ul>
<li>在Gemfile里加上<code>bootstrap-sass</code>然后运行bundle</li>
<li>在<code>app/assets/javascripts/application.js</code>加上<code>//= require bootstrap</code></li>
<li>在<code>app/assets/stylesheets/application.css</code>加上<code>*= require bootstrap</code></li>
</ul>


<p>下一步把<code>omniauth-github</code>Gem加进来:
&ndash; 在Gemfile里加上<code>omniauth-github</code>并执行bundle
&ndash; 新建文件<code>config/initializers/omniauth.rb</code>包含以下内容</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Rails.application.config.middleware.use OmniAuth::Builder do
</span><span class='line'>  provider :github, ENV['GITHUB_KEY'], ENV['GITHUB_SECRET']
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>关于<code>ENV['GITHUB_KEY']</code>和<code>ENV['GITHUB_SECRET']</code>,需要在github上新建一个application,得到的<code>Client ID</code>和<code>Client Secret</code>就是对应的这两个东西,可以把他们写到<code>~/.bashrc</code>里面</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>export GITHUB_KEY='your client id'
</span><span class='line'>export GITHUB_SECRET='your client secret'</span></code></pre></td></tr></table></div></figure>


<p>别忘了source这个文件或重新打开一个终端让显示生效</p>

<p>还要注意你新建application的时候<code>The full URL to your application's homepage</code>和<code>Your application's callback URL</code>对应的端口需要和你的服务对应,比如我这里测试用rails开的3000端口,那我就可以填<code>http://localhost:3000/auth/github</code>和<code>http://localhost:3000/auth/github/callback</code></p>

<p>下面我们需要在页面上加一个通过github登录的link,我直接写到layout里并加上一些div让bootstrap起作用</p>

<figure class='code'><figcaption><span>app/views/layouts/application.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>body<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;navbar navbar-fixed-top&quot;</span><span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;navbar-inner&quot;</span><span class="p">&gt;</span>
</span><span class='line'>      <span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;container&quot;</span><span class="p">&gt;</span>
</span><span class='line'>        <span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;user-nav pull-right&quot;</span><span class="p">&gt;</span>
</span><span class='line'>          <span class="p">&lt;</span>%<span class="p">=</span> link_to <span class="s2">&quot;Github Login&quot;</span><span class="p">,</span> <span class="s2">&quot;/auth/github&quot;</span> %<span class="p">&gt;</span>
</span><span class='line'>        <span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span><span class='line'>      <span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<p>现在访问还看不到我们新加的内容,因为没有指定root,rails访问到的还是静态的index页面</p>

<p>演示方便我们把root改为<code>application#index</code>并加上需要的action和view</p>

<figure class='code'><figcaption><span>config/routes.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>root <span class="s1">&#39;application#index&#39;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">def</span> <span class="k">index</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">mkdir</span> app<span class="sr">/views/</span>application/
</span><span class='line'>touch app<span class="sr">/views/</span>application/<span class="k">index</span>.html.erb
</span></code></pre></td></tr></table></div></figure>


<p>现在应该能看到这个link了,点一下如果看类似<code>No route matches [GET] "/auth/github/callback"</code>说明已经去github做验证并把结果返回回来了</p>

<p>下一步我们需要验证完的回调</p>

<p>从上面的错误信息可以看到回调地址是<code>/auth/github/callback</code>, 所以我们在routes中加一行</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">get</span> <span class="s2">&quot;/auth/:provider/callback&quot;</span> <span class="p">=&gt;</span> <span class="s2">&quot;sessions#create&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后建立controller和action</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>rails <span class="k">g</span> controller sessions create
</span></code></pre></td></tr></table></div></figure>


<p>如果你想看看返回的数据什么样子,可以这样写sessions#create</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">def</span> create
</span><span class='line'>  raise env[<span class="s1">&#39;omniauth.auth&#39;</span>].to_yaml
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>这样点登录的link就会把返回的信息显示在页面上</p>

<p>得到返回数据怎么处理就看个人需要了,你可能会想建一个表保存返回的数据, 这里我们建立users表来保存用户的nickname,由于github的nickname就是用户名,是唯一的,但是考虑到以后可能会加入其它的认证如twitter,nickname就可能冲突了,所以我们还加个provider</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>rails <span class="k">g</span> scaffold <span class="nb">User</span> nickname provider
</span><span class='line'>rake db:migrate
</span></code></pre></td></tr></table></div></figure>


<p>有了保存数据的地方,我们就可以处理返回的验证了</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">def</span> create
</span><span class='line'>  auth <span class="p">=</span> request.env[<span class="s2">&quot;omniauth.auth&quot;</span>]
</span><span class='line'>  user <span class="p">=</span> <span class="nb">User</span>.find_by_omniauth<span class="p">(</span>auth<span class="p">)</span>
</span><span class='line'>  session[:user_id] <span class="p">=</span> user.id
</span><span class='line'>  redirect_to root_url<span class="p">,</span> :notice <span class="p">=&gt;</span> <span class="s2">&quot;Signed in!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>把<code>find_by_omniauth</code>方法放到了model里,它也很简单,能找到就返回,找不到就创建</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">def</span> self.find_by_omniauth<span class="p">(</span>auth<span class="p">)</span>
</span><span class='line'>  user <span class="p">=</span> <span class="nb">User</span>.find_by_provider_and_nickname<span class="p">(</span>auth[<span class="s2">&quot;provider&quot;</span>]<span class="p">,</span> auth[<span class="s2">&quot;info&quot;</span>][<span class="s2">&quot;nickname&quot;</span>]<span class="p">)</span>
</span><span class='line'>  user ? user : <span class="nb">User</span>.create_with_omniauth<span class="p">(</span>auth<span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="nb">def</span> self.create_with_omniauth<span class="p">(</span>auth<span class="p">)</span>
</span><span class='line'>  create<span class="p">!</span> <span class="k">do</span> <span class="p">|</span>user<span class="p">|</span>
</span><span class='line'>    user.provider <span class="p">=</span> auth[<span class="s2">&quot;provider&quot;</span>]
</span><span class='line'>    user.nickname <span class="p">=</span> auth[<span class="s2">&quot;info&quot;</span>][<span class="s2">&quot;nickname&quot;</span>]
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>需要修改一下layout才可以看到登录成功的提示</p>

<figure class='code'><figcaption><span>app/views/layouts/application.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;container&quot;</span> style<span class="p">=</span><span class="s2">&quot;margin-top: 60px;&quot;</span><span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>% flash.each <span class="k">do</span> <span class="p">|</span>name<span class="p">,</span> msg<span class="p">|</span> %<span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;alert alert-&lt;%= name == :notice ? &quot;</span>success<span class="s2">&quot; : &quot;</span>error<span class="s2">&quot; %&gt;&quot;</span><span class="p">&gt;</span>
</span><span class='line'>      <span class="p">&lt;</span><span class="k">a</span> class<span class="p">=</span><span class="s2">&quot;close&quot;</span> data<span class="p">-</span>dismiss<span class="p">=</span><span class="s2">&quot;alert&quot;</span><span class="p">&gt;</span><span class="k">x</span><span class="p">&lt;</span>/<span class="k">a</span><span class="p">&gt;</span>
</span><span class='line'>      <span class="p">&lt;</span>%<span class="p">=</span> msg  %<span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>% <span class="k">end</span> %<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>%<span class="p">=</span> yield %<span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>现在登录已经成功了,我们还需要修改一下github登录的link,让它登录后显示用户名和logout</p>

<p>首先我们需要定义一个帮助方法来判断用户有没登录</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>class ApplicationController <span class="p">&lt;</span> ActionController::Base
</span><span class='line'>
</span><span class='line'>  protect_from_forgery with: :exception
</span><span class='line'>  helper_method :current_user
</span><span class='line'>
</span><span class='line'>  private
</span><span class='line'>
</span><span class='line'>    <span class="nb">def</span> current_user
</span><span class='line'>      @current_user <span class="p">||=</span> <span class="nb">User</span>.find<span class="p">(</span>session[:user_id]<span class="p">)</span> <span class="k">if</span> session[:user_id]
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后定义一条logout的路由</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">get</span> <span class="s2">&quot;signout&quot;</span> <span class="p">=&gt;</span> <span class="s2">&quot;sessions#destroy&quot;</span><span class="p">,</span> :<span class="k">as</span> <span class="p">=&gt;</span> <span class="s2">&quot;signout&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>以及对应的Action</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">def</span> destroy
</span><span class='line'>  session[:user_id] <span class="p">=</span> nil
</span><span class='line'>  redirect_to root_url<span class="p">,</span> :notice <span class="p">=&gt;</span> <span class="s2">&quot;Signed out!&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>最后修改layout</p>

<figure class='code'><figcaption><span>app/controllers/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;user-nav pull-right&quot;</span><span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>% <span class="k">if</span> current_user %<span class="p">&gt;</span>
</span><span class='line'>    Welcome <span class="p">&lt;</span>%<span class="p">=</span> current_user.nickname %<span class="p">&gt;!</span>
</span><span class='line'>    <span class="p">&lt;</span>%<span class="p">=</span> link_to <span class="s2">&quot;Sign out&quot;</span><span class="p">,</span> signout_path %<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>% <span class="k">else</span> %<span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>%<span class="p">=</span> link_to <span class="s2">&quot;Github Login&quot;</span><span class="p">,</span> <span class="s2">&quot;/auth/github&quot;</span> %<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>% <span class="k">end</span> %<span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>基本上这样就算完成了</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/29/ruby-slash-rails-tips-collection/">Ruby/Rails小技巧收集</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-29T11:43:00+08:00" pubdate data-updated="true">Jul 29<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/07/29/ruby-slash-rails-tips-collection/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>收集一些当时做的时候花了好多时间去Google,但本身又很短的小问题的答案,大部分来算StackOverflow</p>

<h3>jQuery on的用法</h3>

<p>on的基本用法为:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$(selector1).on 'event', 'selector2', -&gt;
</span><span class='line'>  ...</span></code></pre></td></tr></table></div></figure>


<p>我遇到的问题是对通过ajax加载的部分on不起作用,解决办法是确保selector1不是通过ajax加载的</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/22/the-ruby-programming-language-notes/">The Ruby Programming Language Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-22T11:14:00+08:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/07/22/the-ruby-programming-language-notes/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li>Global variables are prefixed with $</li>
<li>Instance variables are prefixed with @</li>
<li>Class variables are prefixed with @@</li>
<li>Constant begin with a capital letter</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>/[Rr]uby/   # Matches "Ruby" or "ruby"
</span><span class='line'>/\d{5}/     # Matches 5 consecutive digits
</span><span class='line'>1..3        # All x where 1 &lt;= x &lt;= 3 # has equal both side
</span><span class='line'>1...3       # All x where 1 &lt;= x &lt; 3</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Ruby case statement matches its expression against each of the possible cases using <code>===</code></p></li>
<li><p>Ruby&rsquo;s strings are mutable, call freeze method to prevent any future modifications</p></li>
<li><p>In Ruby world, only nil and false are false, anything else are true</p></li>
<li><p><code>print</code> is almost same with <code>puts</code>, except it does not append a newline</p></li>
<li><p><code>p</code> almost same with <code>puts</code>, except it use <code>inspect</code> rather than <code>to_s</code></p></li>
<li><p>lexical</p></li>
<li>punctuation</li>
<li>syntactic</li>
<li><p>arithmetic</p></li>
<li><p>All numeric objects are immutable</p></li>
<li><p>Integer division by zero causes a ZeroDivisionError to be thrown.</p></li>
<li>Floating-point division by zero does not cause an error; it simple returns the value Infinity</li>
<li><p>0.0/0.0 => NaN</p></li>
<li><p><code>4**3**2</code> is same as <code>4**9</code> not <code>64**2</code></p></li>
<li><p>even = (x[0] == 0)  # A number is even if the least-significat bit is 0</p></li>
<li><p>&lsquo;a\b&rsquo; == &lsquo;a\b&rsquo;</p></li>
<li><p>money = &ldquo;\u{20AC 20 A3 20 A5}&rdquo; # => &ldquo;€ £ ¥&rdquo;</p></li>
<li><p>Run system command</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>`ls`
</span><span class='line'>%x[ls]</span></code></pre></td></tr></table></div></figure>


<p>?A  # Character literal for the  ASCII character A
/&ldquo;  # Character literal for the  ASCII character &rdquo;
/?  # Character literal for the  ASCII character ?
not need any more</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a = 0;
</span><span class='line'>"#{a=a+1} " * 3   # returns "1 1 1", not "1 2 3"</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>s = "hello"
</span><span class='line'>s[index, length]
</span><span class='line'>s[0, 2] # "he"
</span><span class='line'>s[start_index..end_index]   # include end_index
</span><span class='line'>s[start_index...end_index]  # not include end_index
</span><span class='line'>s[/[aeiou]/] = '*'          # replace first vowel with an asterisk</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>s = "¥1000"
</span><span class='line'>s.each_char { |x| print "#{x} " } # Prints "¥ 1 0 0 0". Ruby 1.9
</span><span class='line'>0.upto(s.size-1) { |i| print "#{s[i]} " }  # Inefficient with multibyte chars</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>words = %w[this is a test]  # Same as ['this', 'is', 'a', 'test']</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a = [1, 1, 2, 2, 3, 3, 4]
</span><span class='line'>b = [5, 5, 4, 4, 3, 3, 2]
</span><span class='line'>a | b  # [1, 2, 3, 4, 5]: duplicates are removed
</span><span class='line'>b | a  # [5, 4, 3, 2, 1]: elements are the same, but order is different
</span><span class='line'>a & b  # [2, 3, 4]
</span><span class='line'>b & a  # [4, 3, 2]</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>equality</p></li>
<li><p><code>equal?</code> method is defined by Object to test whether two values refer to exactly the same object</p></li>
<li><p><code>==</code> in Object is just alias to equal? but most class redefine it</p></li>
<li><p><code>!=</code> simple use <code>==</code> and inverts the result</p></li>
<li><p><code>eql?</code> strict version of <code>==</code></p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1 == 1.0    # true: Fixnum and Float objects can be ==
</span><span class='line'>1.eql?(1.0) # false: but they are never eql!</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>===</code> most use in case statement and:

<ul>
<li>Many classes, is the same as ==</li>
<li>Range to test whether a value falls within the range</li>
<li>Regexp to test whether a string matches the regular expression</li>
<li>Class to test whether an object is an instance of that class</li>
<li>In Ruby 1.9 Symbol to return true if the righthand operand is the same symbol as the left or if it is a string holding the same text</li>
</ul>
</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>(1..10) === 5  # true: 5 is in the range 1..10
</span><span class='line'>/\d+/ === "123" # true: the string matches the regular expression
</span><span class='line'>String === "s"  # true: "s" is an instance of the class String
</span><span class='line'>:s === "s"      # true in Ruby 1.9</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p><code>=~</code> pattern match(like Regexp)</p></li>
<li><p><code>&lt;=&gt;</code></p>

<ul>
<li>Return -1 if its left operand is less than its right operand</li>
<li>Return 0 if the two operands are equal</li>
<li>Return 1 if the left operand is greater than the right operand</li>
<li>Return nil if can not meaningfull compared</li>
</ul>
</li>
<li><p>explicit</p></li>
<li><p>to_s:
return a human-readable representation of the object, suitable for end users</p></li>
<li>inspect:
is intended for debugging use, and should return a representation that is helpful to Ruby developers</li>
<li><p>default inspect method, inherited from Object, simple calls to_s</p></li>
<li><p>implicit</p></li>
<li>invocation</li>
<li>abbreviated</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># splat (*)
</span><span class='line'>x, y = 1, *[2, 3] # Same as x, y, z = 1, 2, 3
</span><span class='line'>x, *y = 1, 2, 3   # x = 1; y = [2, 3]
</span><span class='line'>x, *y = 1, 2      # x = 1; y = [2]
</span><span class='line'>x, *y = 1         # x = 1; y = []</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Ruby 1.9 only
</span><span class='line'>*x, y = 1, 2, 3   # x = [1, 2]; y = 3
</span><span class='line'>*x, y = 1, 2      # x=[1]; y = 2
</span><span class='line'>*x, y = 1         # x = []; y = 1
</span><span class='line'>
</span><span class='line'>x, y *z = 1, *[2, 3, 4] # x = 1;y = 2; z=[3,4]</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>&amp;&amp;</code> has higher precedence that <code>||</code></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>1 || 2 && nil  # =&gt; 1</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>and, or and not operators are low-precedence versions of &amp;&amp;, ||, and !
they have lower precedence that the assignment operator</p></li>
<li><p>and and or have the same precedence and not is just slightly higher</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>x || y && nil   # && is performed first   =&gt; x
</span><span class='line'>x or y and nil  # evaluated left-to-right =&gt; nil</span></code></pre></td></tr></table></div></figure>


<ul>
<li><code>?:</code> operator is right-associative(same as **)</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>a ? b : c ? d : e     # This expression ..
</span><span class='line'>a ? b : (c ? d : e)   # is evaluated like this..
</span><span class='line'>(a ? b : c) ? d : e   # NOT like this</span></code></pre></td></tr></table></div></figure>


<ul>
<li>The loop variable or variables of a for loop are not local to the loop; they remain defined even after the loop exit. Similarly, new variables defined within the body of the loop continue to exist after the loop exits.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>squares = [1,2,3].collect {|x| x*x}   # =&gt; [1,4,9]
</span><span class='line'>evens = (1..10).select {|x| x%2 == 0} # =&gt; [2,4,6,8,10]
</span><span class='line'>odds = (1..10).reject {|x| x%2 == 0}  # =&gt; [1,3,5,7,9]</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>data = [2, 5, 3, 4]
</span><span class='line'>sum = data.inject { |sum, x| sum + x }     # =&gt; 14    (1+5+3+4)
</span><span class='line'>floatprod = data.inject(1.0) { |p,x| p*x } # =&gt; 120.0 (1.0*2*5*3*4)
</span><span class='line'>max = data.inject { |m, x| m&gt;x ? m : x }   # =&gt; 5</span></code></pre></td></tr></table></div></figure>


<ul>
<li>implicit</li>
<li><p>fundamental</p></li>
<li><p>use return in a block will cause the method that use yield to call the block exit</p></li>
<li><p>return value in block should use next</p></li>
<li><p>blocks defined a new variable scope: variables created within a block exist only within that block and are undefined outside of the block</p></li>
<li><p>the local variables in a method are available to any blocks within that method. so if a block assigns a value to a variable that is already defined outside of the block, this does not create a new block-local variable but instead assigns a new value to the already-existing variable.</p></li>
<li><p>invocation</p></li>
<li><p>an important difference between block parameters and method parameters is that block parameters are not allowed to have default values assigned as method parameters are.(seems not any more)</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[1,2,3].each {|x,y=10| print x*y }  # SyntaxError!</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>intuitive</p></li>
<li><p>return always causes the enclosing method to return. the enclosing method, also called the lexically enclosing method, is the method that the block appears inside of when you look at the source code</p></li>
<li><p>note that unlike return, break never causes the lexically enclosing method to return. break can only appear within a lexically enclosing loop or within a block. using it in any other context causes a LocalJumpError</p></li>
<li><p>manipulate</p></li>
<li><p>represent</p></li>
<li><p>An important feature of procs and lambdas is that they are closures: they retain access to the local variables that were in scope when they were defined, even then the proc or lambda is invoked from a different scope</p></li>
<li><p>subtle</p></li>
<li>invocation</li>
<li><p>respectively</p></li>
<li><p>Ruby implementations typically treat Fixnum and Symbol values as immediate values rather than as true object references. For this reason, singleton methods may not be defined on Fixnum and Symbol objects. For consistency, singletons are also prohibited on other Numberic objects.</p></li>
<li><p>Interestingly, undef can be used to undefine inherited method, without affecting the definition of the method in the class from which it is inherited.</p></li>
<li><p>It cannot be used to undefine a singleton method in the way that def can be used to define such a method.</p></li>
<li><p>punctuation</p></li>
<li>unary</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>alias aka also_known_as   # alias new_name existing_name</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def hello
</span><span class='line'>  puts 'Hello World'
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>alias original_hello hello
</span><span class='line'>
</span><span class='line'>def hello
</span><span class='line'>  puts 'Your attention please'
</span><span class='line'>  original_hello
</span><span class='line'>  puts 'This has been a test'
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<ul>
<li>overload</li>
<li>ambiguous</li>
<li>wrinkle</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def suffix(s, index=s.size-1)
</span><span class='line'>  s[index, s.size-index]
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>In Ruby 1.8, method parameters with default values must appear after all ordinary parameters in the parameter list. Ruby 1.9 relaxes this restriction and allows ordinary parameters to appear after parameters with defaults. It still requires all parameters with defaults to be adjacent in the parameter list &ndash; you can&rsquo;t declare two parameters with default values with an ordinary parameter between them, for example.</p></li>
<li><p>No more than one parameter may be prefixed with an *. In Ruby 1.8, this parameter must appear after all ordinary parameters and after all parameters with defaults specified. It should be the last parameter of the method, unless the method also has a parameter with an &amp; prefix. In Ruby 1.9, a parameter with an * prefix must still appear after any parameters with defaults specified, but it may be followed by additional ordinary parameters. It must also still appear before any &amp;-prefixed parameter.</p></li>
<li><p>anonymity</p></li>
<li><p>Blocks are syntactic structures in Ruby; they are not objects, and cannot be manipulated as objects.</p></li>
<li>It is possible, however, to create an object that represents a block. Depending on how the object is created, it is called a proc or a lambda</li>
<li><p>Procs have block-like behavior and lambdas have method-like behavior. Both, however, are instances of class Proc.</p></li>
<li><p>Proc.new => procs</p></li>
<li>Kernel.lambda => lambda</li>
<li>Kernel.proc => alias of lambda in Ruby 1.8</li>
<li>Kernel.proc => alias of Proc.new in Ruby 1.9</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>succ = lambda {|x| x+1}  # Ruby 1.8 lambda
</span><span class='line'>succ = -&gt;(x){ x+1 }      # Ruby 1.9 lambda</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># This lambda takes 2 args and declares 3 local vars
</span><span class='line'>f = -&gt;(x,y; i,j,k) { ... }</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>zoom = -&gt;(x,y,factor=2) { [x*factor, y*factor] }   # only on Ruby 1.9</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>succ = -&gt;x { x+1 }
</span><span class='line'>f = -&gt; x,y; i,j,k { ... }
</span><span class='line'>zoom = -&gt;x,y,factor=2 { [x*factor, y*factor] }</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Proc Equality &ndash; The <code>==</code> method only returns true if on Proc is a clone or duplicate of the other;</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>p = lambda {|x| x*x }
</span><span class='line'>q = p.dup
</span><span class='line'>q == p                      # =&gt; true: the two procs are equal
</span><span class='line'>p.object_id == q.object_id  # =&gt; false: they are not the same object
</span><span class='line'>
</span><span class='line'>- A proc is the object form of a block, and it behaves like a block.
</span><span class='line'>- A lambda has slightly modified behavior and behaves more like a mthod that a block.
</span><span class='line'>
</span><span class='line'>- The return statement in a block does not just return from the block to the invoking iterator, it returns from the method that invoked the interator.
</span></code></pre></td></tr></table></div></figure>


<p>def test
  puts &ldquo;entering method&rdquo;
  1.times { puts &ldquo;entering block&rdquo;; return }  # Makes test method return
  puts &ldquo;exiting method&rdquo;   # This line is never executed
end
test</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>- A proc is like a block, so if you call a proc that executes a return statement, it attempts to return from the method that encloses the block that was converted to the proc.
</span></code></pre></td></tr></table></div></figure>


<p>def test
  puts &ldquo;entering method&rdquo;
  p = Proc.new { puts &ldquo;entering proc&rdquo;; return }
  p.call                # Invoking the proc makes method return
  puts &ldquo;exiting method&rdquo; # This line is never executed
end
test</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>- Using a return statement in a proc is tricky, however, because procs are ofter passed around between methods. By the time a proc is invoked, the lexically enclosing method may already have returned:
</span></code></pre></td></tr></table></div></figure>


<p>def procBuilder(message)            # Create and return a proc
  Proc.new { puts message; return } # return returns from procBuilder
  # but procBuilder has already returned here!
end</p>

<p>def test
  puts &ldquo;entering method&rdquo;
  p = procBuilder(&ldquo;entering proc&rdquo;)
  p.call                # Prints &ldquo;entering proc&rdquo; and raises LocalJumpError!
  puts &ldquo;exiting method&rdquo; # This line is never executed
end
test</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>- A return statement in a lambda, therefore, returns from the lambda itself, not from the method that surrounds the creation site of the lambda:
</span></code></pre></td></tr></table></div></figure>


<p>def test
  puts &ldquo;entering method&rdquo;
  p = lambda { puts &ldquo;entering lambda&rdquo;; return }
  p.call                  # Invoking the lambda does not make the method return
  puts &ldquo;exiting method&rdquo;   # This line <em>is</em> executed now
end
test</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>- The fact that return in lambda only returns from the lambda itself means that we never have to worry about LocalJumpError
</span></code></pre></td></tr></table></div></figure>


<p>def lambdaBuilder(message)            # Create and return a proc
  lambda { puts message; return }     # return returns from lambda
  # but procBuilder has already returned here!
end</p>

<p>def test
  puts &ldquo;entering method&rdquo;
  p = lambdaBuilder(&ldquo;entering lambda&rdquo;)
  p.call                # Prints &ldquo;entering lambda&rdquo;
  puts &ldquo;exiting method&rdquo; # This line is executed
end
test</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>- A top-level next statement works the same in a block, proc, or lambda: ti causes the yield statement or call method that invoked the block, proc, or lambda to return. If next is followed by an expression, then the value of that expression becomes the rturn value of the block, proc, or lambda.
</span><span class='line'>
</span><span class='line'>- redo also works the same in procs and lambdas: it transfers control back to the beginning of the proc or lambda.
</span><span class='line'>
</span><span class='line'>- retry is never allowed in procs or lambdas: using it always results in a LocalJumpError.
</span><span class='line'>
</span><span class='line'>- raise behaves the same in blocks, procs, and lambdas. Exceptions always propagate up the call stack. If a block, proc, or lambda raises an exception and there is no local rescue clause, the exception first propagates to the method that invoked the block with yield or that invoked the proc or lambda with call.
</span><span class='line'>
</span><span class='line'>- Argument passing to procs and lambdas
</span><span class='line'>  - The yield statement uses yield semantics
</span><span class='line'>  - method invocation uses invocation semantics
</span><span class='line'>  - Yield semantics are similar to parallel assignment
</span><span class='line'>  - invoking a proc uses yield semantics
</span><span class='line'>  - invoking a lambda uses invocation semantics
</span></code></pre></td></tr></table></div></figure>


<p>p = Proc.new {|x,y| print x,y }
p.call(1)       # x,y=1:     nil used for missing rvalue:  Prints 1nil
p.call(1,2)     # x,y=1,2:   2 lvalues, 2rvalues:          Print 12
p.call(1,2,3)   # x,y=1,2,3: extra rvalues discarded:      Print 12
p.call([1,2])   # x,y=[1,2]: array automatically unpacked: Print 12</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>```
</span><span class='line'>l = lambda {|x,y| print x,y }
</span><span class='line'>l.call(1,2)     # This works
</span><span class='line'>l.call(1)       # Wrong number of arguments
</span><span class='line'>l.call(1,2,3)   # Wrong number of arguments
</span><span class='line'>l.call([1,2])   # Wrong number of arguments
</span><span class='line'>l.call(*[1,2])  # Works: explicit splat to unpack the array</span></code></pre></td></tr></table></div></figure>


<ul>
<li>In Ruby, procs and lambdas are closures.</li>
<li>An object that is both an invocable function and a variable binding for that function.</li>
<li><p>When you create a proc or a lambda, the resulting Proc object holds not just the executable block but also bindings for all the variables used by the block.</p></li>
<li><p>One important difference between Method objects and Proc objects is that Method objects are not closures.</p></li>
<li><p>encapsulated</p></li>
<li><p>In addition to being automatically invoked by Point.new, the initialize method is automatically made private. An object can call initialize on itself, but you cannot explicitly call initialize on p to reinitialize its state.</p></li>
<li><p>coerce</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Point::NEGATIVE_UNIT_X = Point.new(-1,0)</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Class Instance Variables</p>

<ul>
<li>An instance variable used inside a class definition but outside an instance method definition</li>
<li>Class instance variables cannot be used from instance methods</li>
</ul>
</li>
<li><p>Define Class</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Point
</span><span class='line'>  ...
</span><span class='line'>  def Point.sum(*points)
</span><span class='line'>  ...
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Point
</span><span class='line'>  ...
</span><span class='line'>  def self.sum(*points)
</span><span class='line'>    ...
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class &lt;&lt; Point
</span><span class='line'>  def sum(*points)
</span><span class='line'>    ...
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Point
</span><span class='line'>  class &lt;&lt; self
</span><span class='line'>    ...
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Method are normally public unless they are explicitly declared to be private or protected. One exception if the initialize method, which is always implicityly private.</p></li>
<li><p>Another exception is any &ldquo;global&rdquo; method declared outside of a class definition &mdash; those methods are defined as private instance methods of Object.</p></li>
<li><p>A public method can be invoked from anywhere &mdash; where are no restrictions on its use.</p></li>
<li><p>A private method is internal to the implementation of a class, and it can only be called by other instance methods of the class (or, as we&rsquo;ll see later, its subclasses).</p></li>
<li><p>Private methods are implicitly invoked on self, and may not be explicitly invoked on an object.</p></li>
<li><p>If m is a private method, then you must invoke it in functional style as m. You cannot write o.m or even self.m</p></li>
<li><p>A protected method is like a private method in that it can only be invoked from within the implementation of a class or its subclasses. It differs from a private method in that it may be explicit invocatioin on self.</p></li>
<li><p>A protected method can be used, for example, to define an accessor that allows instances of a class to share internal state with each other, but does not allow users of the class to access that state.</p></li>
<li><p>Protected methods are the least commonly defined and also the most difficult to understand. The rule about when a protected method can be invoked can be more formally described as follows: a protected method defined by a class C may be invoked on an object o by a method in the object p if and only if the classes of o and p are both subclasses of, or equal to, the class C.</p></li>
<li><p>One of the important things to understand about object-oriented programming and subclassing is that when methods are invoked, they are looked up dynamically so that the appropriate definition or redefinition of the method is found. That is, method invocations are not bound statically at the time they are parsed, but rather, are looked up at the time they are executed.</p></li>
<li><p>If you use super as a bare keyword &mdash; with no arguments and no parentheses &mdash; then all of the arguments that were passwd to the current method are passed to the superclass method.</p></li>
<li><p>Ruby&rsquo;s instance variables are not inherited and have nothing to do with the inheritance mechanism. The reason that they sometimes appear to be inherited is that instance variables are created by the methods that first assign values to them, and those methods are often inherited or chainned.</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Point3D &lt; Point
</span><span class='line'>  def initialize(x,y,z)
</span><span class='line'>    super(x,y)
</span><span class='line'>    @z = z;
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  def to_s
</span><span class='line'>    "(#@x, #@y, #@z)"
</span><span class='line'>  end
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>In this code, Point3D defines an initialize method that chains tothe initialize method of its superclas.. The chained method assigns values to the variables @x and @y, which makes those variables come into existence for a particular instance of Point3D</p></li>
<li><p>Class variables are inherited</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class A
</span><span class='line'>  @@value = 1
</span><span class='line'>  def A.vaue; @@value; end
</span><span class='line'>end
</span><span class='line'>print A.value
</span><span class='line'>class B &lt; A; @@value = 2; end
</span><span class='line'>print A.value
</span><span class='line'>class C &lt; A; @@value = 3; end
</span><span class='line'>print B.value</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>The important difference between constants and methods is that constants are looked up in the lexical scope of the place they are used before they are looked up in the inheritance hierarchy</p></li>
<li><p>Another way that new objects come into existence is as a result of the dup and clone methods. These methods allocate a new instance of the class of the object on whhich they are invoked. They then copy all the instance variables and the taintedness of the receiver object to the newly allocated object.</p></li>
<li><p>clone takes this copying a step further that dup &mdash; it also copies singleton methods of the receiver object and freezes the copy object if the original is frozen.</p></li>
<li><p>A third way that objects are created is when Marshal.load is called to re-create object previously marshaled (or &ldquo;serialized&rdquo;) with Marshal.dump.</p></li>
<li><p>A singleton is a class that has only a single instance</p></li>
<li><p>A singleton method is a method added to a single object rather than to a class of objects</p></li>
<li><p>A module cannot be instantiated, and it cannot be subclassed</p></li>
<li><p>Modules are used as namespeces and as mixins</p></li>
<li><p>Just as a class object is an instance of the Class class, a module object is an instance of the Module class. Class is a subclass of Module. This means that all classes are modules, but not all modules are classes.</p></li>
<li><p>Class can be used as namespaces, just as modules can. Class cannot, however, be used as mixins.</p></li>
<li><p>The inclusion of a module affects the type-checking method is_a? and the switch-equality operator ===. For example, String mixes in the Comparable module and, in Ruby 1.8, also mixes in the Enumerable module:</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"text".is_a? Comparable  # =&gt; true
</span><span class='line'>Enumerable === "text"    # =&gt; true in Ruby 1.8, false in 1.9</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Note that instance_of? only checks the class of its receiver, not superclasses or modules, so the following is false:</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"text".instance_of? Comparable  # =&gt; false</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>Although every class is a module, the include method does not allow a class to be included within another class. The arguments to include must be modules declared with module, not classes</p></li>
<li><p>If you want to create a module like Math or Kernel (after included, call method without module name), define you methods as instance methods of the module. Then use module_function to convert those methods to &ldquo;module functions.&rdquo;</p></li>
<li><p>In addition to loading source code, require can also load binary extensions to Ruby.</p></li>
<li><p>load expects a complete filename including an extension. require is usually passed a library name, with no extension, rather than a filename. In that case, it searches for a file that has the library name as its base name and an appropriate source or native library extension. If a directory contains both an .rb source file and a binary extension file, require will load the source file instead of the binary file.</p></li>
<li><p>load can load the same file multiple times. require tries to prevent multiple loads of the same file. require keeps track of the files that have been loaded by appending them to the global array $&ldquo; (also known as $LOADED_FEATURES). load does not do this.</p></li>
<li><p>load loads the specified file at the current $SAFE level. require loads the specified library with $SAFE set to 0, even if the code that called require has a higher value for that variable. In theory, therefore, it should be safe for require to load files with a reduced $SAFE level.</p></li>
<li><p>Files loaded with load or require are executed in a new top-level scope that is different from the one in which load or require was invoked. The loaded file can see all global variables and constants that have been defined at the time it is loaded, but it does not have access to the local scope from which the load was initiated</p></li>
<li><p>The local variables defined in the scope from which load or require is invoked are not visible to the loaded file.</p></li>
<li>Any local variables created by the loaded file are discarded once the load is complete; they are never visible outside the file in which they are defined.</li>
<li>At the start of the loaded file, the value of self is always the main object, just as it is when the Ruby interpreter starts running. That is, invoking load or require whthin a method invocation does not propagate the receiver object to the loaded file.</li>
<li><p>The current module nesting is ignored within the loaded file. You cannot, fir example, open a class and load a file of method definitions. The file will be precessed in a top-level scope, not inside any class or module.</p></li>
<li><p>Ruby method lookup or method name resolution ( o.m )</p>

<ul>
<li>First, it checkes the eigenclass of o for singleton methods name m.</li>
<li>If no method m is found in the eigenclass, Ruby searches the class of o for an instance method named m.</li>
<li>If no method m is found in the class, Ruby searches the instance methods of any modules included by the class of o. If that class includes more that one module, then they are searched in the reverse of the order in which they were included. That is the most recently included module is searched first.</li>
<li>If no instance method m is found in the class of o or in its modules, then the search moves up the inheritance hierarchy to the superclass. Steps 2 and 3 are repeated for each class in the inheritance hierarchy until each ancestor class and its included modules have ben searched.</li>
<li>If no method named m is found after completing the search, then a method named method_missing is invoked instand. In order to find an appropriate definition of this method, the name resolution algorithm start over at step 1. The Kernel module a default implementation of method_messing, so this second pass of name resolution is guranteed to succeed.</li>
</ul>
</li>
<li><p>Class objects are special: they have superclasses.</p></li>
<li><p>The eigenclasses of class objects are also special: they have superclasses, too.</p></li>
<li><p>refection</p></li>
<li>introspection</li>
<li>examine</li>
<li><p>malicious</p></li>
<li><p>Note that eval evaluates its code in a temporary scope. eval can alter the value of instance variables that already exist. But any new instance variables it defines are local to the invocation of eval and cease to exist when it returns. (It is as if the evaluated code is run in the body of a block &mdash; variables local to a block do not exist outside the block)</p></li>
<li><p>synonym</p></li>
<li><p>It is important to understand that define_method is private. You must be inside the class or module you want to use it on in order to call it:</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Add an instance method named m to class with body b
</span><span class='line'>def add_method(c, m, &b)
</span><span class='line'>  c.class_eval {
</span><span class='line'>    define_method(m, &b)
</span><span class='line'>  }
</span><span class='line'>end
</span><span class='line'>
</span><span class='line'>add_method(String, :greet) { "Hello, " + self }
</span><span class='line'>
</span><span class='line'>"world".greet # =&gt; "Hello, world"</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/21/datetimepicker-demo/">日期时间选择插件使用</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-21T23:22:00+08:00" pubdate data-updated="true">Jul 21<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/07/21/datetimepicker-demo/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>以前做过这样的东西,花了好多时间,因为要选择到底用那个插件,还有好多插件要只有日期没有时间,今天做这样的东西又花了不少时间,决定记录下来,下一次就简单多了</p>

<p>我使用的是<code>jQuery</code>的<code>datepicker</code>加上<a href="https://github.com/trentrichardson/jQuery-Timepicker-Addon">jQuery-Timepicker-Addon</a></p>

<p>示例代码在这里: <a href="https://github.com/williamherry/datetimepicker-demo">datetimepicker-demo</a>,懒得看详细的步骤可以直接看代码</p>

<p>效果类似这样:</p>

<p><img src="/images/datetimepicker.png"></p>

<ul>
<li>首先创建项目</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new datetimepicker-demo</span></code></pre></td></tr></table></div></figure>


<ul>
<li>然后我创建了一个叫activity的scaffold,插件会用到start_at这个字段上</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g scaffold activity title content:text start_at:datetime
</span><span class='line'>rake db:migrate</span></code></pre></td></tr></table></div></figure>


<ul>
<li><p>下来我们要把需要的插件加进来,jquery-ui我用一个非常方便的gem: <a href="https://github.com/joliss/jquery-ui-rails">jquery-ui-rails</a>, 只要加到<code>Gemfile</code>里<code>gem jquery-ui-rails</code>,运行<code>bunder</code>就行了</p></li>
<li><p><a href="https://github.com/trentrichardson/jQuery-Timepicker-Addon">jQuery-Timepicker-Addon</a>我是自己下载下来把需要的文件复制到项目的vender目录下,需要用到三个文件:<code>jquery-ui-timepicker-addon.js</code>, <code>jquery-ui-timepicker-addon.css</code>和<code>i18n</code>目录下的<code>jquery-ui-timepicker-zh-CN.js</code>, js文件复制到<code>vendor/assets/javascripts/</code>, css文件复制到<code>vendor/assets/stylesheets/</code></p></li>
<li><p>需要的文件都加进来了,下面我们需要在include他们</p></li>
</ul>


<figure class='code'><figcaption><span>app/assets/javascripts/application.js</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="sr">//</span><span class="p">=</span> require jquery
</span><span class='line'><span class="sr">//</span><span class="p">=</span> require jquery.ui.datepicker
</span><span class='line'><span class="sr">//</span><span class="p">=</span> require jquery.ui.slider
</span><span class='line'><span class="sr">//</span><span class="p">=</span> require jquery<span class="p">-</span>ui<span class="p">-</span>timepicker<span class="p">-</span>addon
</span><span class='line'><span class="sr">//</span><span class="p">=</span> require jquery<span class="p">-</span>ui<span class="p">-</span>timepicker<span class="p">-</span>zh<span class="p">-</span>CN
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/assets/stylesheets/application.css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'> *<span class="p">=</span> require jquery.ui.datepicker
</span><span class='line'> *<span class="p">=</span> require jquery.ui.slider
</span><span class='line'> *<span class="p">=</span> require jquery<span class="p">-</span>ui<span class="p">-</span>timepicker<span class="p">-</span>addon
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>准备工作都做完了,下来就是使用了</li>
</ul>


<figure class='code'><figcaption><span>app/views/activities/_form.html.erb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>  <span class="p">&lt;</span>div class<span class="p">=</span><span class="s2">&quot;field&quot;</span><span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>%<span class="p">=</span> <span class="k">f</span>.label :start_at %<span class="p">&gt;&lt;</span><span class="k">br</span><span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>%<span class="p">=</span> <span class="k">f</span>.text_field :start_at<span class="p">,</span> :id <span class="p">=&gt;</span> <span class="s2">&quot;datetimepicker&quot;</span> %<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>/div<span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>app/assets/javascripts/activities.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>$ <span class="p">-&gt;</span>
</span><span class='line'>  $<span class="p">(</span><span class="s2">&quot;#datetimepicker&quot;</span><span class="p">)</span>.datetimepicker
</span><span class='line'>    stepMinute: <span class="m">5</span>
</span><span class='line'>    dateFormat: <span class="s2">&quot;yy-mm-dd&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>更多参数和例子可以看<a href="http://trentrichardson.com/examples/timepicker/#tp-options">这里</a></p>

<p>这样就算完成了,但是虽然加了那个i18n的文件,月和周的显示还是英文, 这可以直接在js文件里加,也可以在<code>vendor/assets/javascripts/jquery-ui-timepicker-zh-CN.js</code>中加上这两行</p>

<figure class='code'><figcaption><span>app/assets/javascripts/activities.js.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>  monthNames: [<span class="s1">&#39;一月&#39;</span><span class="p">,</span> <span class="s1">&#39;二月&#39;</span><span class="p">,</span> <span class="s1">&#39;三月&#39;</span><span class="p">,</span> <span class="s1">&#39;四月&#39;</span><span class="p">,</span> <span class="s1">&#39;五月&#39;</span><span class="p">,</span> <span class="s1">&#39;六月&#39;</span><span class="p">,</span> <span class="s1">&#39;七月&#39;</span><span class="p">,</span> <span class="s1">&#39;八月&#39;</span><span class="p">,</span> <span class="s1">&#39;九月&#39;</span><span class="p">,</span> <span class="s1">&#39;十月&#39;</span><span class="p">,</span> <span class="s1">&#39;十一月&#39;</span><span class="p">,</span> <span class="s1">&#39;十二月&#39;</span>]<span class="p">,</span>
</span><span class='line'>  dayNamesMin: [<span class="s1">&#39;周日&#39;</span><span class="p">,</span> <span class="s1">&#39;周一&#39;</span><span class="p">,</span> <span class="s1">&#39;周二&#39;</span><span class="p">,</span> <span class="s1">&#39;周三&#39;</span><span class="p">,</span> <span class="s1">&#39;周四&#39;</span><span class="p">,</span> <span class="s1">&#39;周五&#39;</span><span class="p">,</span> <span class="s1">&#39;周六&#39;</span>]<span class="p">,</span>
</span></code></pre></td></tr></table></div></figure>


<h3>资源:</h3>

<ul>
<li><a href="https://github.com/joliss/jquery-ui-rails">jquery-ui-rails</a></li>
<li><a href="http://jqueryui.com/datepicker/">jquery datepicker</a></li>
<li><a href="https://github.com/trentrichardson/jQuery-Timepicker-Addon">jQuery Timepicker Addon</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/10/allow-ip-from-shanghai-do-something/">只允许上海的用户注册</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-10T13:33:00+08:00" pubdate data-updated="true">Jul 10<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/07/10/allow-ip-from-shanghai-do-something/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>刚开始听到老板说这个需求的时候,我还傻呼呼一直在想要怎么得到所有上海的IP地址,都打算试着写爬虫去爬这些数据,事实上我只要判断一个客户端的IP是不是属于上海就行了,而这个动作可以由一些第三方提供的API来做,像百度就有提供这个的服务</p>

<p>转过弯来就比较简单了,我的方法在<code>app/controller/application_controller.rb</code>文件里加一个helper方法</p>

<figure class='code'><figcaption><span>app/controller/application_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>class ApplicationController <span class="p">&lt;</span> ActionController::Base
</span><span class='line'>  helper_method :is_shanghai_ip?
</span><span class='line'>...
</span><span class='line'>  <span class="nb">def</span> is_shanghai_ip?<span class="p">(</span>ip<span class="p">)</span>
</span><span class='line'>    uri <span class="p">=</span> <span class="s2">&quot;http://api.map.baidu.com/location/ip?ak=your_api_key&amp;ip=#{ip}&amp;coor=bd09ll&quot;</span>
</span><span class='line'>    resp <span class="p">=</span> Net::HTTP.get_response<span class="p">(</span>URI.parse<span class="p">(</span>uri<span class="p">))</span>
</span><span class='line'>    data <span class="p">=</span> resp.body
</span><span class='line'>    result <span class="p">=</span> JSON.parse<span class="p">(</span>data<span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> false <span class="k">if</span> result[<span class="s1">&#39;status&#39;</span>] <span class="p">==</span> <span class="m">1</span>
</span><span class='line'>    result[<span class="s1">&#39;content&#39;</span>][<span class="s1">&#39;address&#39;</span>] <span class="p">==</span> <span class="s2">&quot;上海市&quot;</span> ? true : false
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>...
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>然后在你要做控制的action中调用这个方法,比如我们要限制只有上海的用户可以注册</p>

<figure class='code'><figcaption><span>app/controller/users_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="nb">def</span> sign_up
</span><span class='line'>  unless is_shanghai_ip?<span class="p">(</span>request.remote_ip<span class="p">)</span>
</span><span class='line'>    redirect_to <span class="s2">&quot;/about/us&quot;</span> and <span class="k">return</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  ...
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>百度提供的这个服务的地址是: <a href="http://developer.baidu.com/map/ip-location-api.htm">http://developer.baidu.com/map/ip-location-api.htm</a></p>

<p>另外有一个叫<code>geocoder</code>的gem非常强大,它直接在<code>Rack::Request</code>里塞一个<code>location</code>的方法,你可以直接在controller里这样调用</p>

<figure class='code'><figcaption><span>app/controller/users_controller.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'>city <span class="p">=</span> request.location.city
</span><span class='line'>country <span class="p">=</span> request.location.country_code
</span></code></pre></td></tr></table></div></figure>


<p>此外它还有一些非常强大的功能如查找经纬度,查找附近,查找距离等等,更详细的信息可以访问它的<a href="http://www.rubygeocoder.com/">官方网站</a>, <a href="http://railscasts.com/episodes/273-geocoder">RailsCast</a>还有一期是介绍它的</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/07/09/image-grayscale-for-ie10/">IE10下图片灰度处理</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-07-09T17:18:00+08:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/07/09/image-grayscale-for-ie10/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>其它浏览器或版本的图片灰度处理可以看<a href="http://www.karlhorky.com/2012/06/cross-browser-image-grayscale-with-css.html">这里</a></p>

<p>上面的方法对IE10是没有效果的,Google了好久发现只有用svg才对IE10才有作用,想知道svg是什么请看<a href="http://www.w3school.com.cn/svg/svg_intro.asp">这里</a></p>

<p>下面的代码就可以对图片做灰度的处理</p>

<figure class='code'><figcaption><span>~/tmp/index.html</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="p">&lt;</span>svg xmlns<span class="p">=</span><span class="s2">&quot;http://www.w3.org/2000/svg&quot;</span> id<span class="p">=</span><span class="s2">&quot;svgroot&quot;</span> viewBox<span class="p">=</span><span class="s2">&quot;0 0 100 100&quot;</span> width<span class="p">=</span><span class="s2">&quot;100&quot;</span> height<span class="p">=</span><span class="s2">&quot;100&quot;</span><span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>defs<span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>filter id<span class="p">=</span><span class="s2">&quot;filtersPicture&quot;</span><span class="p">&gt;</span>
</span><span class='line'>      <span class="p">&lt;</span>feComposite result<span class="p">=</span><span class="s2">&quot;inputTo_38&quot;</span> <span class="k">in</span><span class="p">=</span><span class="s2">&quot;SourceGraphic&quot;</span> in2<span class="p">=</span><span class="s2">&quot;SourceGraphic&quot;</span> operator<span class="p">=</span><span class="s2">&quot;arithmetic&quot;</span> k1<span class="p">=</span><span class="s2">&quot;0&quot;</span> k2<span class="p">=</span><span class="s2">&quot;1&quot;</span> k3<span class="p">=</span><span class="s2">&quot;0&quot;</span> k4<span class="p">=</span><span class="s2">&quot;0&quot;</span> /<span class="p">&gt;</span>
</span><span class='line'>      <span class="p">&lt;</span>feColorMatrix id<span class="p">=</span><span class="s2">&quot;filter_38&quot;</span> type<span class="p">=</span><span class="s2">&quot;saturate&quot;</span> values<span class="p">=</span><span class="s2">&quot;0&quot;</span> data<span class="p">-</span>filterid<span class="p">=</span><span class="s2">&quot;38&quot;</span> /<span class="p">&gt;</span>
</span><span class='line'>    <span class="p">&lt;</span>/filter<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>/defs<span class="p">&gt;</span>
</span><span class='line'>  <span class="p">&lt;</span>image filter<span class="p">=</span><span class="s2">&quot;url(&amp;quot;#filtersPicture&amp;quot;)&quot;</span> <span class="k">x</span><span class="p">=</span><span class="s2">&quot;0&quot;</span> <span class="k">y</span><span class="p">=</span><span class="s2">&quot;0&quot;</span> width<span class="p">=</span><span class="s2">&quot;100&quot;</span> height<span class="p">=</span><span class="s2">&quot;100&quot;</span> xmlns:xlink<span class="p">=</span><span class="s2">&quot;http://www.w3.org/1999/xlink&quot;</span> xlink:href<span class="p">=</span><span class="s2">&quot;http://williamherry.com/images/chef/attributes.jpg&quot;</span> /<span class="p">&gt;</span>
</span><span class='line'><span class="p">&lt;</span>/svg<span class="p">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="p">&lt;</span>img src<span class="p">=</span><span class="s2">&quot;http://williamherry.com/images/chef/attributes.jpg&quot;</span><span class="p">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>为了做比较我在后面放了一个不做处理的图片,你可以把上面的代码保存为<code>.html</code>格式文件用浏览器打开看看</p>

<p>上面的代码可以达到我们期望的效果,但是又有新的问题,我给它的高和宽都设置的100,但从浏览器来看它好像并不是正方形.</p>

<p>这里的问题是它是按比例缩放的,例如图片是100X1000,如果我给它设置成100X100,那么最终图片的显示可能是10X100,没有完全填满100X100</p>

<p>对于这个问题我还没有找到完美的解决办法,但有一个办法已经可以满足我自己的需求,这个方法是在<code>&lt;image</code>后面加上<code>preserveAspectRatio="xMidYMid slice"</code></p>

<p>还用上面的例子,它会把图片按比较放到和短的边一样, 这里是100X1000,然后把100X100的框放中间,多余的裁掉,剩下的就是显示的部分</p>

<p><img src="/images/svg/preverse-aspect-ratio.svg"></p>

<p>这样只要保存图片的比例和设置的很接近就可以基本上解决这个问题</p>

<p>更多<code>preserveAspectRatio</code>的信息请看<a href="http://www.w3.org/TR/SVG/coords.html">这里</a></p>

<h2>更新</h2>

<p>StackOverflow上对<a href="http://stackoverflow.com/questions/17540298/image-inside-svg-width-and-height-not-working-as-expected/17545343">这个问题</a>已经有人回答了,让图片按给定的高和宽拉伸只要把<code>preserveAspectRatio</code>设置成<code>none</code>就可以了</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/05/13/understand-stub-and-mock/">理解测试中的stub和mock</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-13T16:46:00+08:00" pubdate data-updated="true">May 13<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/05/13/understand-stub-and-mock/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>刚开始学习<code>rspec</code>的时候,<code>stub</code>和<code>mock</code>理解起来有点困难,听了<code>Terry</code>和<code>aNdReW</code>的讲解后,对它们的理解深入多了,在此表示感谢</p>

<p>先从<code>stub</code>说起,什么是<code>stub</code>呢,<code>CodeSchool</code>给出这样的定义:</p>

<blockquote><p>Stub:<br/>
For replacing a method with code that returns a specified result</p></blockquote>

<p>简单说就是你可以用<code>stub</code>去<strong>伪造(fade)</strong>一个方法,<strong>阻断</strong>对原来方法的调用,例如下面来自<code>CodeSchool</code>的例子</p>

<p>我们有一个叫<code>zombie</code>的<code>model</code></p>

<figure class='code'><figcaption><span>app/models/zombie.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">Zombie</span> <span class="o">&lt;</span> <span class="ss">ActiveRecord</span><span class="p">:</span><span class="ss">:Base</span>
</span><span class='line'>  <span class="n">has_one</span> <span class="ss">:weapon</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">decapitate</span>
</span><span class='line'>    <span class="n">weapon</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="nb">self</span><span class="p">,</span> <span class="ss">:head</span><span class="p">)</span>
</span><span class='line'>    <span class="nb">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;dead again&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>我们要测试<code>decapitate</code>方法,它里面调用了<code>weapon</code>的<code>slice</code>方法,下面是测试代码:</p>

<figure class='code'><figcaption><span>/spec/models/zombie_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Zombie</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:zombie</span><span class="p">)</span> <span class="p">{</span> <span class="no">Zombie</span><span class="o">.</span><span class="n">create</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">context</span> <span class="s2">&quot;#decapitate&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;sets status to dead again&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">zombie</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">stub</span><span class="p">(</span><span class="ss">:slice</span><span class="p">)</span>
</span><span class='line'>      <span class="n">zombie</span><span class="o">.</span><span class="n">decapitate</span>
</span><span class='line'>      <span class="n">zombie</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="s2">&quot;dead again&quot;</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>上面代码的第6行就是用<code>stub</code>伪造了<code>weapon</code>的<code>slice</code>方法,阻断了对原来方法的调用</p>

<p>你可能会问为什么我们要这样做,这是因为我们在做单元测试,<code>weapon</code>的<code>slice</code>可能会非常复杂,里面又调用了其它的方法等等,这是集成测试应该做的工作.事实上这里我们是在测试<code>decapitate</code>方法会把<code>zombie.status</code>设置成<code>"dead again"</code></p>

<p>接下来我们来说<code>mock</code>, <code>CodeSchool</code>上给的定义是这样的:</p>

<blockquote><p>Mock:<br/>
A stub with an expectations that the method gets called.</p></blockquote>

<p>简单来说<code>mock</code>就是<code>stub + expectation</code>, 说它是<code>stub</code>是因为它也可以像<code>stub</code>一样伪造方法,阻断对原来方法的调用, <code>expectation</code>是说它不仅伪造了这个方法,它还期望你(必须)调用这个方法,如果没有被调用到,这个<code>test</code>就<code>fail</code>了,看下面的例子</p>

<figure class='code'><figcaption><span>/spec/models/zombie_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="no">Zombie</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">let</span><span class="p">(</span><span class="ss">:zombie</span><span class="p">)</span> <span class="p">{</span> <span class="no">Zombie</span><span class="o">.</span><span class="n">create</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">context</span> <span class="s2">&quot;#decapitate&quot;</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">it</span> <span class="s2">&quot;calls weapon.slice&quot;</span> <span class="k">do</span>
</span><span class='line'>      <span class="n">zombie</span><span class="o">.</span><span class="n">weapon</span><span class="o">.</span><span class="n">should_receive</span><span class="p">(</span><span class="ss">:slice</span><span class="p">)</span>
</span><span class='line'>      <span class="n">zombie</span><span class="o">.</span><span class="n">decapitate</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>这里的第6行伪造了<code>weapon</code>的<code>slice</code>方法,并期望这个方法在这个测试中被调用.</p>

<p>你可能会想为什么要这样写,这是因为我们仅仅是要测试<code>decapitate</code>这个方法确实调用了<code>weapon.slice</code>, 可以把<code>decapitate</code>想成下面的黑盒,我们蹲在图中的A点,等着看它会不会去调用<code>weapon.slice</code></p>

<p><img src="/images/test/test_outgoing.jpg"></p>

<p>这个图是<code>Sandi Metz</code>在<code>RailsConf 2013</code>上的演讲<code>The Magic Tricks of Testing</code></p>

<p><a href="http://www.justin.tv/confreaks/c/2247122">视频</a></p>

<p><a href="https://speakerdeck.com/skmetz/magic-tricks-of-testing-railsconf">Slides</a></p>

<p>这里注意一下顺序,一般的测试先是执行一个动作,然后再去判断状态或其它东西,像前面<code>stub</code>的例子,先调用decapitate方法,再去判断<code>status</code>的变化,就好像我踢你一脚,看你会不会喊疼,而这里是先有期望再有动作,这就好比老板对你说这个下周前完成,不然就滚蛋一样</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/03/23/opensuse-12-dot-3-font-configuration/">openSUSE 12.3 安装完后需要做的事情</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-03-23T02:36:00+08:00" pubdate data-updated="true">Mar 23<span>rd</span>, 2013</time>
        
         | <a href="/blog/2013/03/23/opensuse-12-dot-3-font-configuration/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>今天终于把openSUSE12.3安装上了,记得上次安装openSUSE应该是好几年前吧,那时候刚开始玩Linux.记得当时选发行版的时候很纠结,老想用openSUSE但当时它还是有很多问题,尤其严重的是显示上有点问题,图形界面和字符界面不能同时和显示器边对齐,以当时的水平解决不了这个问题,就放弃而一直用的Ubuntu</p>

<p>今天安装上了最新的12.3,比以前进步太多了,fcitx输入法安装就能用(以前很麻烦的,尤其是环境是英文的),各种驱动自动帮你安好,进系统就可以开启3D,KDE4.10已经非常稳定了,不像以前动不动就Crash. 总的来说我非常满意,以后就用她了</p>

<p>不过openSUSE 12.3的默认字体还是非常难看的,需要做一些配置才可以让人看着舒服</p>

<p>其实根本的问题并不是没有好看的字体,而是字体的渲染不给力,使字体看起来很虚,锯齿很厉害,我从网上找的这个办法可以开启抗锯齿,分享给大家</p>

<p>原文地址在<a href="http://tuxperience.blogspot.com/2012/12/fix-ugly-fonts-in-kubuntu-or-kde-make.html">这里</a></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Fix: Ugly Fonts in Kubuntu or KDE | Make your fonts crystal clear
</span><span class='line'>
</span><span class='line'>By default, KDE Desktop and Kubuntu have a very ugly font behavior compared to GNOME or Ubuntu. But no worries. Fix is easy!
</span><span class='line'>
</span><span class='line'>How to fix it?
</span><span class='line'>
</span><span class='line'>1- Go to "System Settings &gt; Application Appearance &gt; Fonts"
</span><span class='line'>2- Enable anti-ailising.
</span><span class='line'>3- Set Use sub-pixel rendering to RGB and Slight.
</span><span class='line'>4- Go Advanced tab of Desktop Effects and set scale method to Crisp.
</span><span class='line'>
</span><span class='line'>To improve your fonts more, change your fonts to DejaVu and for a better console set console fonts to DejaVu Sans Mono 9.5.
</span><span class='line'>
</span><span class='line'>Now you have very cyrstal looking fonts! Have fun!</span></code></pre></td></tr></table></div></figure>


<p>我刚开始照他的做也看不到效果的,花了好长时间,发现一个很有意思的事情,就是把字体放大到16以后和缩小到8以后字体的渲染开始变得非常漂亮,后来才发现在第三步设置anti-ailising的时候点击后面的configure在弹出的窗口中有<code>Exclude range</code>正好是8和16,我是勾选了的,原来我把8到16之间的字体除过不渲染,去掉之后漂亮的字体终于出来了.现在你可以随便选择你喜欢的字体,都会有很好的效果</p>

<p>PS: 这些文字就是在新的openSUSE 12.3下面写的,看来以后要和Ubuntu说再见了</p>

<p>UPDATE: 无线网络的问题</p>

<p>Release Note中有说安装完无线网没有启动,需要手机重启系统,但是我发现我还遇到一个问题,有时候开机无线网络是没有连上了,点开直接是空的,我在<a href="http://forums.opensuse.org/english/get-technical-help-here/network-internet/470567-wireless-problems-opensuse-12-1-a.html">这里</a>找到了解决办法,简单说就是默认他用的<code>dhcpd</code>好像不太稳定,改成<code>dhclient</code>就好了</p>

<p>在<code>/etc/sysconfig/network/dhcp</code>中修改下面两行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>DHCLIENT_BIN="dhclient"
</span><span class='line'>DHCLIENT_DEBUG="yes"</span></code></pre></td></tr></table></div></figure>


<p>加第二行是因为有一个<a href="https://bugzilla.novell.com/show_bug.cgi?id=732910">bug</a> (不过好像已经修复了)</p>

<p>UPDATE2: 支付宝插件</p>

<p>需要安装<code>libpng12-0</code>才可以使支付宝的插件安装成功,不然它提示成功但却用不了</p>

<p>UPDATE3: 无线网硬件禁用的问题</p>

<p>从sleep状态resume后无线网会是硬件禁用状态,需要手动按<code>Fn + F3</code>开启,后来发现是驱动冲突,在<code>/etc/modprobe.d/50-blacklist.conf</code>中的最后加上<code>blacklist acer-wmi</code>就好了</p>

<p>还有一直让我很迷惑的<code>Magic Lamp</code>的问题,我很早就发现这个特效会有两种不同的效果,有时会最小化收到状态栏,有时会收到鼠标的位置,后来才知道原来收到鼠标的位置是一种fallback的情形,有的时候收到状态栏不可用,比如程序刚启动的时候,状态栏还没有调整好,这时候这个特效就会收到鼠标的位置</p>

<p>还有默认的配置如果你一段时间不操作电脑,他会出现输入密码的登陆的画面,但只要你动一下鼠标或键盘就消失了,我看的一个youtube上的视频上还有人说这是个bug,其实不是,这只是它的默认屏保画面而已</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/02/05/rvm-rake-cron-ubuntu/">最简单的在crontab中执行rake命令的方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-02-05T11:26:00+08:00" pubdate data-updated="true">Feb 5<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/02/05/rvm-rake-cron-ubuntu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>stackoverflow上很多都说要添加变量什么的,这是我发现的最简单而且能工作的方法,原文在<a href="http://www.wyliethomas.com/blog/2011/08/24/rvm-rake-and-cron-on-ubuntu/">这里</a></p>

<p>方法很简单,在crontab中可以定义环境变量</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>crontab -e</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SHELL = /home/william/.rvm/bin/rvm-shell
</span><span class='line'>
</span><span class='line'>* 4 * * * /bin/bash -l -c 'cd /path/to/app && RAILS_ENV=production rake mytask –silent'</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/01/25/rails-image-upload/">Rails图片上传</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-25T22:27:00+08:00" pubdate data-updated="true">Jan 25<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/25/rails-image-upload/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>好久没有更新这个了,竟然连<code>rake new_post['title']</code>都忘记了还得查文档,看来以后还是得时不时的写点</p>

<p>这里简单记录一下Rails中如何处理图片上传,我们选择<a href="https://github.com/jnicklas/carrierwave">CarrierWave</a>这个gem来处理上传的文件,由于重点是处理图片上传,所以我们会使用scaffolding生成一个article的CURD,把图片绑定给它(一个article有一个图片)</p>

<p>首先我们创建一个Rails项目</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails new image-upload-demo</span></code></pre></td></tr></table></div></figure>


<p>然后用脚手架生成article</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd image-upload-demo
</span><span class='line'>rails g scaffold article title:string content:text</span></code></pre></td></tr></table></div></figure>


<p>执行migration生成数据库表结构</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rake db:migrate</span></code></pre></td></tr></table></div></figure>


<p><code>rails s</code>启动服务,访问<code>http://localhost:3000/articles</code>检查有没错误</p>

<p>如果没有问题,下一步我们就可以设定CarrierWave了,首先是安装,在Gemfile里添加一行</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'carrierwave'</span></code></pre></td></tr></table></div></figure>


<p>然后执行<code>bundle install</code>进行安装,然后用下面的命令创建uploader</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g uploader photo</span></code></pre></td></tr></table></div></figure>


<p>这会创建<code>app/uploaders/photo_uploader.rb</code>这个文件,carrierwave的一些设定都在这个文件里面,我们目前先不做更改,只使用默认配置</p>

<p>接着我们给article表加一个字段来存储文件信息</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>rails g migration AddPhotoToArticles photo:string</span></code></pre></td></tr></table></div></figure>


<p>别忘了执行<code>rake db:migrate</code>生成表结构</p>

<p>然后的article的model里加入调用carrierwave的代码</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># app/models/article.rb
</span><span class='line'>class Article &lt; ActiveRecord::Base
</span><span class='line'>  attr_accessible :content, :title, :photo
</span><span class='line'>
</span><span class='line'>  mount_uploader :photo, PhotoUploader
</span><span class='line'>end</span></code></pre></td></tr></table></div></figure>


<p>别忘了把<code>photo</code>也加到<code>attr_accessible</code>里哦
这样Model和数据库就可以处理上传上来的文件了,接下来在view里加入上传图片的代码</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># app/views/articles/_form.html.erb
</span><span class='line'>&lt;%= form_for(@article, :html =&gt; {:multipart =&gt; true}) do |f| %&gt;
</span><span class='line'>...
</span><span class='line'>  &lt;div class="field"&gt;
</span><span class='line'>    &lt;%= f.label :title %&gt;&lt;br /&gt;
</span><span class='line'>    &lt;%= f.text_field :title %&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="field"&gt;
</span><span class='line'>    &lt;%= f.label :content %&gt;&lt;br /&gt;
</span><span class='line'>    &lt;%= f.text_area :content %&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="field"&gt;
</span><span class='line'>    &lt;label&gt;My Photo&lt;/label&gt;
</span><span class='line'>    &lt;%= f.file_field :photo %&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>  &lt;div class="actions"&gt;
</span><span class='line'>    &lt;%= f.submit %&gt;
</span><span class='line'>  &lt;/div&gt;
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>关键在form_for中添加<code>:html =&gt; {:multipart =&gt; true}</code>,现在就可以使用上传的功能了,并且上传的图片可以简单的使用<code>&lt;%= image_tag @article.photo %&gt;</code>来调用,我们再在显示的view里加入显示图片的代码</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># app/views/articles/show.html.erb
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span><span class='line'>  &lt;b&gt;Photo:&lt;/b&gt;
</span><span class='line'>  &lt;%= image_tag @article.photo %&gt;
</span><span class='line'>&lt;/p&gt;
</span><span class='line'>...</span></code></pre></td></tr></table></div></figure>


<p>现在就可以测试了</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/07/29/omniauth-github-demo/">omniauth-github使用示例</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/29/ruby-slash-rails-tips-collection/">Ruby/Rails小技巧收集</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/22/the-ruby-programming-language-notes/">The Ruby Programming Language Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/21/datetimepicker-demo/">日期时间选择插件使用</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/10/allow-ip-from-shanghai-do-something/">只允许上海的用户注册</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/09/image-grayscale-for-ie10/">IE10下图片灰度处理</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/05/13/understand-stub-and-mock/">理解测试中的stub和mock</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/03/23/opensuse-12-dot-3-font-configuration/">openSUSE 12.3 安装完后需要做的事情</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/williamherry">@williamherry</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'williamherry',
            count: 6,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - William Herry -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'williamherry';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
