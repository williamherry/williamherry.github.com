
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>安装配置Git服务器Gitolite - William's Blog with Octopress</title>
  <meta name="author" content="William Herry">
  <meta name="google-site-verification" content="_KlSpzhIase_SfpNrkXR9D4RIMUinnyi_QB6FS7UhBs" />

  
  <meta name="description" content="Gitolite的代码做了更改,网上好多安装教程都不再适用,所以在这里简单记录一下我的安装方法 安装 首先安装必要的软件 yum -y install git 添加用户 useradd --system --shell /bin/bash --create-home git 设置密码 passwd &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://williamherry.com/blog/2012/10/03/install-gitolite/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="William's Blog with Octopress" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


<!-- this font looks great -->
<link href='http://fonts.googleapis.com/css?family=Delius' rel='stylesheet' type='text/css'>

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">William's Blog with Octopress</a></h1>
  
    <h2>Octopress is A blogging framework for hackers.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:williamherry.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Home</a></li>
  <li><a href="/blog">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">安装配置Git服务器Gitolite</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-03T18:38:00+08:00" pubdate data-updated="true">Oct 3<span>rd</span>, 2012</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Gitolite的代码做了更改,网上好多安装教程都不再适用,所以在这里简单记录一下我的安装方法</p>

<h3>安装</h3>

<h4>首先安装必要的软件</h4>

<pre><code>yum -y install git
</code></pre>

<h4>添加用户</h4>

<pre><code>useradd --system --shell /bin/bash --create-home git
</code></pre>

<h4>设置密码</h4>

<pre><code>passwd git
</code></pre>

<h4>拷贝公钥</h4>

<p>Gitolite管理的方式是给你一个特殊的仓库,修改,提交,推送到服务器就可以了,这个仓库只可以管理员访问,现在把管理员的公钥复制到服务器上(可以和Git服务器在同一台服务器上也可以在不同的服务器上)</p>

<pre><code># 如果没有key先生成
ssh-keygen
ssh-copy-id git@git-server
</code></pre>

<h4>安装Gitolite</h4>

<p>现在在Git服务器上切换到git用户进行安装</p>

<pre><code># change to git user
su - git

# gitolite will install here
mkdir bin

# authorized_keys is admin's pubkey
mv ~/.ssh/authorized_keys ~/git.pub

# get the source code
git clone git://github.com/sitaramc/gitolite.git

# install
~/gitolite/install -to ~/bin

# setup
~/bin/gitolite setup -pk ~/git.pub
</code></pre>

<p>安装已经完成了,可以在以管理用户进行测试(前面运行<code>ssh-copy-id</code>的服务器)</p>

<pre><code>ssh git@chef-server
</code></pre>

<p>应该看到类似这样的输出:</p>

<pre><code>hello git, this is git@desktop running gitolite3 v3.04-20-g6328ec2 on git 1.7.9.5

  R W   gitolite-admin
Connection to localhost closed.closed
</code></pre>

<p>可以把管理仓库克隆下来管理Git服务器</p>

<pre><code>git clone git:git-server:gitolite-admin.git
</code></pre>

<p>要添加用户,只要把用户的公钥复制到这个仓库里的<code>keydir</code>下并以<code>username.pub</code>命名,然后提交并推送到服务器</p>

<h3>添加用户示例(jenny)</h3>

<pre><code>cd gitolite-admin
cp path/of/jenny's/pubkey keydir/jenny.pub
git add keydir
git commit -m "add new user jenny"
git push
</code></pre>

<h3>创建仓库示例</h3>

<p>假如我们要创建一个名为<code>notes</code>的仓库,让刚创建的<code>jenny</code>有读写权限</p>

<pre><code>cd gitolite-admin
vi conf/gitolite.conf
</code></pre>

<p>添加类似下面这内容进去</p>

<pre><code>repo notes
    RW    =   jenny
</code></pre>

<p>保存,提交并推送到远和服务</p>

<pre><code>git add -u
git commit -m 'add new repo notes and assign RW to jenny'
git push
</code></pre>

<p>推送的时候应该看到类似这样的信息</p>

<pre><code>Counting objects: 7, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (4/4), 395 bytes, done.
Total 4 (delta 1), reused 0 (delta 0)
remote: Initialized empty Git repository in /home/git/repositories/notes.git/
To git@desktop:gitolite-admin
   6de90b8..52737aa  master -&gt; master
</code></pre>

<p>注意<code>remote</code>开头的一行,它已经帮你创建了这个仓库</p>

<h3>通配符仓库的创建示例</h3>

<p>通配符仓库事先不能确定名字,所以不会帮你创建,在你clone的时候才会创建</p>

<p>编辑<code>conf/gitolite.conf</code>文件在里面加入类似下面的内容</p>

<pre><code>repo sandbox/.+$
  C      =   jenny
  RW+C   =   jenny
</code></pre>

<p>注意<code>C  =  username</code>的一行必不可少,这里的<code>C</code>是指创建仓库的意思,下一行的<code>RW+C</code>中的<code>C</code>是指创建引用(branch,tag)的意思</p>

<p>保存后提交并推送到服务上去</p>

<pre><code>git add -u
git commit -m 'add wildcard repo'
git push
</code></pre>

<p>注意看<code>push</code>时输出的信息,应该没有创建仓库的信息</p>

<p>这时<code>jenny</code>克隆仓库的时候会自动创建</p>

<pre><code># as jenny user
git clone git@desktop:sandbox/test.git
</code></pre>

<p>输出应该类似这样</p>

<pre><code>Cloning into 'test'...
Initialized empty Git repository in /home/git/repositories/sandbox/test.git/
warning: You appear to have cloned an empty repository.
</code></pre>

<p>如果你的输出报这样的错</p>

<pre><code>FATAL: R any sandbox/test jenny DENIED by fallthru
(or you mis-spelled the reponame)
fatal: The remote end hung up unexpectedly
</code></pre>

<p>一般是没有<code>C  =  username</code>这一行,注意是只有<code>C</code>的一行</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">William Herry</span></span>

      








  


<time datetime="2012-10-03T18:38:00+08:00" pubdate data-updated="true">Oct 3<span>rd</span>, 2012</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://williamherry.com/blog/2012/10/03/install-gitolite/" data-via="williamherry" data-counturl="http://williamherry.com/blog/2012/10/03/install-gitolite/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2012/09/14/virt-releated-command/" title="Previous Post: virt相关命令总结">&laquo; virt相关命令总结</a>
      
      
        <a class="basic-alignment right" href="/blog/2012/10/09/chef-lwrp/" title="Next Post: Chef基础之LWRP">Chef基础之LWRP &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/09/10/memcached-cache-analysis/">Memcached Cache Analysis</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/08/22/login-from-console/">Login From Console</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/02/11/learning-chef-ohai-source-code/">Chef Ohai源码学习</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/01/2014-plans/">2014年规划</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/29/omniauth-github-demo/">omniauth-github使用示例</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/29/ruby-slash-rails-tips-collection/">Ruby/Rails小技巧收集</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/22/the-ruby-programming-language-notes/">The Ruby Programming Language Notes</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/07/21/datetimepicker-demo/">日期时间选择插件使用</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/williamherry">@williamherry</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'williamherry',
            count: 6,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - William Herry -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'williamherry';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://williamherry.com/blog/2012/10/03/install-gitolite/';
        var disqus_url = 'http://williamherry.com/blog/2012/10/03/install-gitolite/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>






  <script type="text/javascript">
    var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
    document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fb7d5e56d88d60f662ac5925d6ef11e5b' type='text/javascript'%3E%3C/script%3E"));
  </script>
</body>
</html>
